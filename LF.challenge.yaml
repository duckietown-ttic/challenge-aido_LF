challenge: aido2_LF_r1-v3

title: "LF - Lane following "
tags: [aido2, LF, v3]
description: |
  Lane following challenge.

  This challenge is described in the detail [in the book](http://docs.duckietown.org/DT19/AIDO/out/index.html).

protocol: aido2_db18_agent_1


date-open: 2018-12-07
date-close: 2019-12-07

roles: {}

scoring:
  scores:

    # performance
    - name: driven_lanedir_consec_median
      short: Traveled distance
      description: |
        This is the median distance traveled, *along a lane*.
        (That is, going in circles will not make this metric increase.)

        This is discretized to tiles.
      order: higher-is-better
      discretization: 0.62

    - name: survival_time_median
      short: Survival time
      description: |
        This is the median survival time. The simulation
        is terminated when the car goes outside of the road
        or it crashes with an obstacle.
      order: higher-is-better
      discretization: 2.0

    - name: deviation-center-line_median
      short: Lateral deviation
      description: |
        This is the median lateral deviation from the center line.
      order: lower-is-better
      discretization: 0.01

    - name: in-drivable-lane_median
      short: Major infractions
      description: |
        This is the median of the time spent outside of the drivable zones.
        For example this penalizes driving in the wrong lane.
      order: lower-is-better
      discretization: 0.2



steps:
  step1-simulation:
    title: Simulation step
    description: ""

    timeout: 10
    evaluation_parameters:
      services:
        evaluator:
          environment:
            DISABLE_CONTRACTS: 1
            AIDONODE_ENCODING: cbor
            experiment_manager_parameters: |
              episodes_per_scenario: 1
              steps_per_episode: 14
              min_nsteps: 1
              seed: 42
          build:
            context: ./experiment_manager

        scenario_maker:
          environment:
            DISABLE_CONTRACTS: 1
            AIDONODE_ENCODING: cbor
            AIDONODE_DATA_IN: /fifos/scenario_maker-in
            AIDONODE_DATA_OUT: fifo:/fifos/scenario_maker-out
            AIDONODE_CONFIG: |
              maps:
              - 4way
              scenarios_per_map: 2
          build:
            context: ./scenario_maker

        simulator:
          build:
            context: ./simulator_only
          environment:
            AIDONODE_DATA_IN: /fifos/simulator-in
            AIDONODE_DATA_OUT: fifo:/fifos/simulator-out
            AIDONODE_ENCODING: cbor
            AIDONODE_CONFIG: |
              env_constructor: Simulator
              env_parameters:
                max_steps: 500001 # we don't want the gym to reset itself
                domain_rand: 0
                camera_width: 640
                camera_height: 480
                distortion: true
        solution:
          image: SUBMISSION_CONTAINER
          environment:
            AIDONODE_DATA_IN: /fifos/agent-in
            AIDONODE_DATA_OUT: fifo:/fifos/agent-out
            AIDONODE_ENCODING: cbor

  step2-scoring:
    title: Scoring step
    description: ""

    timeout: 10
    evaluation_parameters:
      services:
        scorer:
          build:
            context: ./scorer




transitions:
  - [START, success, step1-simulation]
  - [step1-simulation, success, step2-scoring]
  - [step1-simulation, failed, FAILED]
  - [step1-simulation, error, ERROR]
  - [step2-scoring, success, SUCCESS]
  #  - [step2-scoring, success, step3-videos]
  - [step2-scoring, failed, FAILED]
  - [step2-scoring, error, ERROR]
#  - [step3-videos, success, step4-viz]
#  - [step3-videos, failed, FAILED]
#  - [step3-videos, error, ERROR]
#  - [step4-viz, success, SUCCESS]
#  - [step4-viz, failed, FAILED]
#  - [step4-viz, error, ERROR]
