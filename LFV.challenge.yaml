challenge: aido1_LFV_r2-v3

title: "LFV - Lane following with vehicles (rev. 2 - dynamic, 20 samples)"
tags: [aido1, LFV, v3]
description: |
  Lane following with vehicles.

  This challenge is described in the detail [in the book](http://docs.duckietown.org/DT18/AIDO/out/index.html).

protocol: aido1_remote3-v3


date-open: 2018-10-01
date-close: 2018-12-07

roles: {}


scoring:
    scores:

    # performance
    - name: driven_lanedir_consec_median
      short: Traveled distance
      description: |
        This is the median distance traveled, *along a lane*.
        (That is, going in circles will not make this metric increase.)

        This is discretized to tiles.
      order: higher-is-better
      discretization: 0.62

    - name: survival_time_median
      short: Survival time
      description: |
        This is the median survival time. The simulation
        is terminated when the car goes outside of the road
        or it crashes with an obstacle.
      order: higher-is-better
      discretization: 2.0


    # naturality
    - name: deviation-center-line_median
      short: Lateral deviation
      description: |
        This is the median lateral deviation from the center line.
      order: lower-is-better
      discretization: 0.01

    - name: in-drivable-lane_median
      short: Major infractions
      description: |
        This is the median of the time spent outside of the drivable zones.
        For example this penalizes driving in the wrong lane.
      order: lower-is-better
      discretization: 0.2


steps:
  step1-simulation:
    title: Simulation step
    description: ""

    timeout: 10
    evaluation_parameters:
      services:
        evaluator:
          image: _
          environment:
            solution_parameters:
              env: Duckietown-Lf-Lfv-Navv-Silent-v1

            launcher_parameters:
              challenge: LF
              episodes: 7
              steps_per_episode: 500
              #environment: Duckietown-Lf-Lfv-Navv-Silent-v0
              environment-constructor: Simulator
              include_map: true
              # passed to the environment
              environment-parameters:
                seed: 232 # random seed
                map_name: loop_dyn_duckiebots
                max_steps: 500000 # we don't want the gym to reset itself
                domain_rand: 0
                camera_width: 640
                camera_height: 480
                accept_start_angle_deg: 6 # start close to straight
                full_transparency: true
                distortion: true
              # passed to the agent in the "misc" field
              agent-info:
                challenge: LF
          build:
            context: ./simulation
        solution:
            image: SUBMISSION_CONTAINER

    features_required: {}

  step2-scoring:
    title: Scoring step
    description: ""

    timeout: 10
    evaluation_parameters:
      services:
        scorer:
          image: _
          build:
            context: ./scorer

    features_required: {}

  step3-videos:
    title: Making videos
    description: ""
    timeout: 10
    evaluation_parameters:
      services:
        videos:
          image: _
          build:
            context: ./videos

    features_required: {}

  step4-viz:
    title: Visualization
    description: ""
    timeout: 10
    evaluation_parameters:
      services:
        visualization:
          image: _
          build:
            context: ./visualization

    features_required: {}


transitions:
  - [START, success, step1-simulation]
  - [step1-simulation, success, step2-scoring]
  - [step1-simulation, failed, FAILED]
  - [step1-simulation, error, ERROR]
  - [step2-scoring, success, step3-videos]
  - [step2-scoring, failed, FAILED]
  - [step2-scoring, error, ERROR]
  - [step3-videos, success, step4-viz]
  - [step3-videos, failed, FAILED]
  - [step3-videos, error, ERROR]
  - [step4-viz, success, SUCCESS]
  - [step4-viz, failed, FAILED]
  - [step4-viz, error, ERROR]
